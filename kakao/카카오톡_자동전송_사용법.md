# 🎯 카카오톡 오픈채팅방 자동 전송 시스템 완전 설정 가이드

> **한국천문연구원 KASI API 연동 버전 (2024년 최신)**  
> 정확한 공휴일, 임시공휴일, 대체공휴일 감지 기능 포함

## 🌟 시스템 특징

- ✅ **한국시간(KST) 기준** 자동화 스케줄링
- ✅ **한국천문연구원 API** 활용한 정확한 공휴일 감지
- ✅ **카카오 i 오픈빌더** 연동 메시지 전송
- ✅ **GitHub Actions** 무료 서버 활용
- ✅ **날씨 정보** 포함 상황별 메시지
- ✅ **피크타임 15분 간격**, **일반시간 30분 간격** 지능형 스케줄

---

## 📋 목차

1. [사전 준비사항](#사전-준비사항)
2. [카카오 i 오픈빌더 설정](#카카오-i-오픈빌더-설정)
3. [공공데이터 포털 API 키 발급](#공공데이터-포털-api-키-발급)
4. [GitHub 설정](#github-설정)
5. [환경 변수 설정](#환경-변수-설정)
6. [테스트 및 실행](#테스트-및-실행)
7. [문제 해결](#문제-해결)

---

## 🎯 사전 준비사항

### 필요한 계정들
- **카카오 계정** (i 오픈빌더용)
- **GitHub 계정** (자동화 서버용)
- **공공데이터 포털 계정** (한국천문연구원 API용)
- **OpenWeather 계정** (날씨 정보용, 선택사항)

---

## 🤖 카카오 i 오픈빌더 설정

### Step 1: 카카오 i 오픈빌더 접속

1. **[카카오 i 오픈빌더](https://i.kakao.com/)** 접속
2. 카카오 계정으로 로그인
3. **"새 챗봇 만들기"** 클릭

### Step 2: 챗봇 생성

1. **챗봇 이름**: 원하는 이름 입력
2. **채널 선택**: "카카오톡 채널" 선택
3. **생성 완료**

### Step 3: 스킬(Skill) 설정

1. 좌측 메뉴에서 **"스킬"** 선택
2. **"+ 스킬 추가"** 클릭
3. 스킬 정보 입력:
   ```
   스킬명: 자동미션전송
   URL: https://api.example.com/webhook (임시, 나중에 변경)
   ```

### Step 4: 시나리오 설정

1. **"시나리오"** 메뉴 접속
2. **"기본 시나리오"** 편집
3. **"폴백 블록"** 설정:
   - 스킬: 앞서 만든 "자동미션전송" 선택
   - 응답: "스킬 데이터" 선택

### Step 5: 카카오톡 채널 연결

1. **"배포"** 메뉴 접속
2. **"카카오톡 채널"** 선택
3. 기존 채널 연결 또는 새 채널 생성

---

## 🏛️ 공공데이터 포털 API 키 발급

### Step 1: 공공데이터 포털 가입

1. **[공공데이터 포털](https://www.data.go.kr/)** 접속
2. 회원가입 및 로그인

### Step 2: 한국천문연구원 특일정보 API 신청

1. 검색창에 **"한국천문연구원 특일 정보"** 검색
2. **한국천문연구원_특일 정보** 선택
3. **"활용신청"** 클릭
4. 신청 정보 입력:
   ```
   활용목적: 카카오톡 챗봇 공휴일 정보 제공
   서비스명: 카카오톡 자동 메시지 서비스
   ```
5. **즉시 승인** (자동승인)

### Step 3: API 키 확인

1. **"마이페이지"** → **"데이터활용"** → **"개발계정"**
2. **서비스키(Decoding)** 복사 보관

---

## 🐙 GitHub 설정

### Step 1: Repository 생성

1. **GitHub**에서 새 Repository 생성
2. **Public** 또는 **Private** 선택
3. Repository에 모든 파일 업로드

### Step 2: GitHub Actions 활성화

1. Repository의 **"Actions"** 탭 접속
2. GitHub Actions 활성화 확인

### Step 3: 디렉토리 구조 설정

```
your-repo/
├── .github/
│   └── workflows/
│       └── auto-send-mission.yml
├── github_actions_sender.py
├── requirements.txt
└── README.md
```

---

## 🔐 환경 변수 설정

### Step 1: GitHub Secrets 설정

1. Repository → **"Settings"** → **"Secrets and variables"** → **"Actions"**
2. **"New repository secret"** 클릭하여 다음 변수들 추가:

#### 필수 환경 변수

```bash
# 카카오 i 오픈빌더 웹훅 URL
WEBHOOK_URL=https://chatbot-api.kakao.com/v1/webhook/your-bot-id

# 한국천문연구원 API 키
KOREA_HOLIDAY_API_KEY=your-kasi-api-key-here

# 카카오 REST API 키 (선택사항)
KAKAO_REST_API_KEY=your-kakao-rest-api-key

# 카카오톡 채널 ID (선택사항)
KAKAO_CHANNEL_ID=your-channel-id

# 날씨 API 키 (선택사항)
OPENWEATHER_API_KEY=your-openweather-api-key

# 디버그 모드 (개발용)
DEBUG_MODE=false
```

### Step 2: 웹훅 URL 설정

1. **카카오 i 오픈빌더**에서 **"스킬"** 편집
2. **URL**을 실제 GitHub Actions 엔드포인트로 변경:
   ```
   https://api.github.com/repos/your-username/your-repo/dispatches
   ```

---

## 🚀 테스트 및 실행

### Step 1: 수동 테스트

1. Repository → **"Actions"** → **"카카오톡 오픈채팅방 자동 미션 전송"**
2. **"Run workflow"** → **"Run workflow"** 클릭
3. 실행 로그 확인

### Step 2: 스케줄 확인

시스템은 다음 스케줄로 자동 실행됩니다:

#### 평일 (월-금)
- **09:00**: 아침 인사 메시지
- **09:30-23:30**: 30분 간격 (피크타임 제외)
- **06:00-13:00, 17:00-20:00**: 15분 간격 (피크타임)
- **00:00**: 자정 마무리 메시지

#### 주말/공휴일
- **09:00**: 아침 인사 메시지  
- **09:30-23:30**: 30분 간격 (피크타임 제외)
- **06:00-14:00, 17:00-20:00**: 15분 간격 (피크타임)
- **00:00**: 자정 마무리 메시지

### Step 3: 로그 모니터링

- **GitHub Actions** 탭에서 실행 로그 확인
- 한국시간 변환 정상 작동 확인
- 공휴일 감지 정상 작동 확인

---

## 🔧 문제 해결

### 자주 발생하는 문제들

#### 1. 메시지가 전송되지 않는 경우

**확인사항:**
- `WEBHOOK_URL` 정확성 확인
- 카카오 i 오픈빌더 스킬 설정 확인
- GitHub Secrets 설정 확인

**해결방법:**
```bash
# 1. 디버그 모드 활성화
DEBUG_MODE=true

# 2. 수동 실행으로 로그 확인
# Actions → Run workflow

# 3. 웹훅 URL 재확인
```

#### 2. 공휴일이 인식되지 않는 경우

**확인사항:**
- `KOREA_HOLIDAY_API_KEY` 유효성 확인
- 공공데이터 포털 API 할당량 확인

**해결방법:**
```bash
# API 키 재발급
# 공공데이터 포털 → 마이페이지 → 개발계정
```

#### 3. 시간대가 맞지 않는 경우

**확인사항:**
- 스케줄이 UTC 기준으로 설정되어 있는지 확인
- 한국시간(KST) 변환이 정상 작동하는지 확인

#### 4. GitHub Actions 할당량 초과

**해결방법:**
- Public Repository 사용 (무제한)
- 스케줄 빈도 조정
- 필요시 Private Repository의 무료 할당량 확인

---

## 📊 모니터링 및 유지보수

### 1. 일간 체크리스트

- [ ] GitHub Actions 실행 로그 확인
- [ ] 메시지 전송 정상 작동 확인
- [ ] 공휴일 감지 정상 작동 확인

### 2. 주간 체크리스트

- [ ] API 할당량 사용량 확인
- [ ] 시스템 안정성 확인
- [ ] 메시지 템플릿 업데이트 검토

### 3. 월간 체크리스트

- [ ] 의존성 패키지 업데이트
- [ ] 카카오 i 오픈빌더 정책 변경사항 확인
- [ ] 공공데이터 API 정책 변경사항 확인

---

## 🆕 최신 업데이트 (2024년 기준)

### 한국천문연구원 API 개선사항

- ✅ **임시공휴일 실시간 반영**: 정부 발표 임시공휴일 자동 감지
- ✅ **대체공휴일 정확도 향상**: 주말과 겹치는 공휴일의 대체공휴일 정확 계산
- ✅ **선거일 정보 포함**: 각종 선거일 정보 자동 포함

### 카카오 i 오픈빌더 정책 변경

- ✅ **메시지 길이 제한**: 최대 1000자 (버튼/이미지 없는 경우)
- ✅ **API 호출 제한**: 분당 100회 (무료 계정)
- ✅ **웹훅 타임아웃**: 5초 이내 응답 필요

---

## 🎉 완료!

이제 시스템이 완전히 설정되었습니다! 

**자동으로 다음 기능들이 작동합니다:**
- 🌅 매일 오전 9시 아침 인사
- 🎯 시간대별 맞춤 미션 메시지
- 🎉 공휴일/기념일 특별 메시지
- 🌙 자정 마무리 인사
- 🌤️ 실시간 날씨 정보
- 📅 다가오는 공휴일 알림

**문의사항이 있으시면 GitHub Issues를 활용해주세요!** 🚀

---

## 📚 참고 자료

- [카카오 i 오픈빌더 공식 문서](https://i.kakao.com/docs/)
- [한국천문연구원 API 문서](https://astro.kasi.re.kr/information/pageView/31)
- [공공데이터 포털](https://www.data.go.kr/)
- [GitHub Actions 문서](https://docs.github.com/en/actions)
- [Python pytz 문서](https://pypi.org/project/pytz/)

---

> **버전**: 3.0 (KASI API 통합)  
> **마지막 업데이트**: 2024년 12월  
> **호환성**: Python 3.9+, GitHub Actions 